# NightMemo 开发计划

这是一个旨在为黑暗环境设计的单文档、听觉反馈优先的中文编辑应用。

## 1. 技术栈选择

* **核心框架**: React + Vite (轻量、快速)

* **样式**: TailwindCSS (便于构建高对比度暗色 UI)

* **音频核心**:

  * `Web Audio API`: 用于按键、退格、确认时的实时音效（低延迟）。

  * `Web Speech API (TTS)`: 用于朗读功能。

* **状态管理**: React Hooks (useReducer) 处理复杂的输入状态机。

## 2. 核心功能模块策划

### 2.1 输入处理引擎 (Input Engine)

这是本应用最核心的部分，需要实现一个自定义的输入缓冲区（Buffer）。

* **Buffer 逻辑**: 拦截全局键盘事件，不使用原生的 `<input>` 或 `contenteditable` 的默认行为，完全接管输入流。

* **数字键映射策略**:

  * `Keys 0-4`: **拼音确认键**。将当前 buffer 内容标记为拼音并附带声调，提交到文档（如果输入不是合法的拼音，则提示错误，buffer 清空）

    * 例: 输入 `h` `a` `o` -> buffer: "hao" -> 输入 `3` -> 文档追加 "hao3 " -> 清空 buffer。

  * `Keys 5-9`: **英文确认键**。将当前 buffer 内容标记为英文单词，提交到文档。

    * 例: 输入 `w` `o` `r` `d` -> buffer: "word" -> 输入 `5` -> 文档追加 "word " -> 清空 buffer。

* **Backspace 逻辑**:

  * 若 Buffer 非空: 清空整个 Buffer + 播放删除音效。

  * 若 Buffer 为空: 删除文档中上一个已确认的 Token (拼音或单词) + 播放不同音效。

### 2.2 音频反馈系统 (Audio System)

* **确认音效**: 按下数字键清空 buffer 时朗读出刚刚输入的拼音/单词。

* 错误音效：如果 buffer 中的拼音不合法，清空整个 buffer 并触发错误音效；英语不检查

* **删除音效**: Backspace 触发提示音。

* **朗读功能**:

  * 提供快捷键朗读当前段落。

  * 提供快捷键朗读上一个句子。

### 2.3 数据结构 (Data Structure)

为了方便未来接入 LLM/IME，数据不应只存储纯文本字符串，而是 Token 列表：

```typescript
type Token = {
  id: string;
  raw: string;      // 原始输入, 如 "hao"
  tone?: number;    // 声调 0-4
  type: 'pinyin' | 'english' | 'punctuation';
  display: string;  // 目前显示 "hao3", 未来可变为 "好"
}
```

## 3. 实施步骤

### Phase 1: 基础框架搭建

1. 初始化 Vite + React + TypeScript 项目。
2. 配置 TailwindCSS 全黑主题。
3. 创建基础的 `AudioContext` 管理器。

### Phase 2: 核心输入逻辑开发

1. 实现 `useInputBuffer` Hook：处理字符输入、Buffer 暂存。
2. 实现 `DocumentEditor` 组件：渲染 Token 列表。
3. 实现数字键分界逻辑 (0-4 vs 5-9)。
4. 实现 Backspace 的删除逻辑。

### Phase 3: 音频反馈集成

1. 为输入动作绑定 Oscillator (振荡器) 音效。
2. 集成 `window.speechSynthesis` 实现朗读功能。

### Phase 4: 界面与优化

1. 制作极简 UI：全黑背景，微光文字，无多余 UI 元素。
2. 添加使用说明（Help Overlay）。

### Phase 5: 验证与测试

1. 闭眼测试：验证是否能仅凭听觉完成输入和修改。
2. 验证混合输入逻辑的流畅性。

这个计划将首先构建一个纯拼音/英文流的编辑器，并为未来接入智能转换预留了 Token 结构。
